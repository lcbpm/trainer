# 6. 错误处理

## 📋 目录

- [6.1 错误处理理论](#61-错误处理理论)
- [6.2 错误处理实践](#62-错误处理实践)

---

**Q: error接口的设计哲学？**
- 显式错误处理vs异常机制
- errors.Is和errors.As的使用

**Q: 如何设计良好的错误处理？**
- 错误包装和上下文信息

### 6.2 错误处理实践

#### 错误包装
```go
func processFile(filename string) error {
    file, err := os.Open(filename)
    if err != nil {
        return fmt.Errorf("打开文件失败 %s: %w", filename, err)
    }
    defer file.Close()
    
    data, err := io.ReadAll(file)
    if err != nil {
        return fmt.Errorf("读取文件内容失败 %s: %w", filename, err)
    }
    
    if err := process(data); err != nil {
        return fmt.Errorf("处理数据失败: %w", err)
    }
    
    return nil
}
```

#### 自定义错误类型
```go
type ValidationError struct {
    Field string
    Value interface{}
    Tag   string
}

func (e ValidationError) Error() string {
    return fmt.Sprintf("验证失败: 字段 %s 值 %v 不满足规则 %s", 
        e.Field, e.Value, e.Tag)
}

func validate(data interface{}) error {
    // 验证逻辑
    return &ValidationError{
        Field: "email",
        Value: "invalid-email",
        Tag:   "email",
    }
}
```